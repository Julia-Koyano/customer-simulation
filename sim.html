<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>æ¥å®¢ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³</title>
  <link rel="stylesheet" href="style.css">
</head>
<body class="quiz-page">
<div class="background">
  <div class="top-stripes"></div>

  <div class="back-to-home">
    <a href="index.html" class="home-button">
      <img src="bookmark.png" alt="Home" />
      <span class="home-label">HOME</span>
    </a>
  </div>

  <div class="header">
    <h1>æ¥å®¢ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³</h1>
    <p>Practice customer interactions through simulation.</p>
  </div>

  <div id="conversation" class="question"></div>
  <button id="restartBtn" style="display:none;">Reset</button>
  <div id="options" class="question"></div>

  <div class="bottom-stripes"></div>
</div>

<script>
const conversation = document.getElementById("conversation");
const options = document.getElementById("options");

const steps = {
  start: {
    message: "ã„ã‚‰ã£ã—ã‚ƒã„ã¾ã›",
    en: "Welcome.",
    audio: "voice/58 (4).wav",
    options: [
      { text: "ãƒŸãƒ©ãƒã‚µãƒ³ãƒ‰ãã ã•ã„", en: "I'd like a Milano sandwich, please.", next: "milano" },
      { text: "ã‚³ãƒ¼ãƒ’ãƒ¼ãã ã•ã„", en: "I'd like a coffee, please.", next: "coffee_type" }
    ]
  },
  coffee_type: {
    message: "ãƒ›ãƒƒãƒˆã¨ã‚¢ã‚¤ã‚¹ãŒã”ã–ã„ã¾ã™",
    en: "We have hot and iced.",
    audio: "voice/58 (5).wav",
    options: [
      { text: "ãƒ›ãƒƒãƒˆ", en: "Hot, please.", next: "coffee_size" },
      { text: "ã‚¢ã‚¤ã‚¹", en: "Iced, please.", next: "coffee_size" }
    ]
  },
  coffee_size: {
    message: "ã‚µã‚¤ã‚ºã¯ã„ã‹ãŒãªã•ã„ã¾ã™ã‹ï¼Ÿ",
    en: "What size would you like?",
    audio: "voice/58 (6).wav",
    options: [
      { text: "S", en: "Small, please.", next: "coffee_to_go" },
      { text: "M", en: "Medium, please.", next: "coffee_to_go" },
      { text: "L", en: "Large, please.", next: "coffee_to_go" }
    ]
  },
  coffee_to_go: {
    message: "åº—å†…ã®ã”åˆ©ç”¨ã§ã™ã‹ï¼Ÿ",
    en: "Is this for here?",
    audio: "voice/58 (3).wav",
    options: [
      { text: "ã¯ã„", en: "Yes, for here.", next: "done" },
      { text: "ãƒ†ã‚¤ã‚¯ã‚¢ã‚¦ãƒˆã§", en: "To go, please.", next: "done" }
    ]
  },
  milano: {
    message: "ãƒŸãƒ©ãƒã‚µãƒ³ãƒ‰Aã€Bã€Cã¨ã”ã–ã„ã¾ã™",
    en: "We have Milano Sandwich A, B, and C.",
    audio: "voice/58 (17).wav",
    options: [
      { text: "A", en: "A, please.", next: "drink_offer" },
      { text: "B", en: "B, please.", next: "drink_offer" },
      { text: "C", en: "C, please.", next: "drink_offer" }
    ]
  },
  drink_offer: {
    message: "ãŠé£²ã¿ç‰©ã¯ã„ã‹ãŒã§ã™ã‹ï¼Ÿã™ã¹ã¦ã®ãŠé£²ã¿ç‰©ãŒ50å††å¼•ãã®ã‚»ãƒƒãƒˆãŒã”ã–ã„ã¾ã™",
    en: "Would you like a drink? All drinks are Â¥50 off in a set.",
    audio: "voice/58 (18).wav",
    options: [
      { text: "ã‚³ãƒ¼ãƒ’ãƒ¼ãã ã•ã„", en: "I'd like a coffee, please.", next: "coffee_type" },
      { text: "ã„ã‚‰ãªã„ã§ã™", en: "No, thank you.", next: "done" }
    ]
  },
  done: {
    message: "ã‹ã—ã“ã¾ã‚Šã¾ã—ãŸã€‚ãŸã ã„ã¾ã”ç”¨æ„ã„ãŸã—ã¾ã™",
    en: "Certainly. I'll prepare that right away.",
    audio: "voice/58 (19).wav",
    options: []
  }
};

let currentStep = "start";

function showStep(stepKey, userReply = null) {
  const prevStep = steps[currentStep];

  // ğŸ‘¤ ãŠå®¢ã•ã‚“ã®ç™ºè¨€ï¼ˆå‰ã®é¸æŠè‚¢ï¼‰
  if (userReply) {
    const userOption = steps[currentStep].options.find(o => o.text === userReply);
    const userBubble = document.createElement("div");
    userBubble.className = "chat-bubble user";
    userBubble.innerHTML = `ğŸ‘¤ ${userReply}<br><em>â†’ ${userOption?.en || ""}</em>`;
    conversation.appendChild(userBubble);
  }

  currentStep = stepKey; 
  const step = steps[stepKey];


  // ğŸ‘¨â€ğŸ³ åº—å“¡ã®ç™ºè¨€ã¨éŸ³å£°
  const staffBubble = document.createElement("div");
  staffBubble.className = "chat-bubble staff";
  staffBubble.innerHTML = `
    ğŸ‘¨â€ğŸ³ ${step.message}<br>
    <em>â†’ ${step.en || ""}</em>
    ${step.audio ? `<br><button onclick="document.getElementById('audio-${stepKey}').play()">ğŸ”Š éŸ³å£°ã‚’èã</button>` : ''}
    ${step.audio ? `<audio id="audio-${stepKey}" src="${step.audio}"></audio>` : ''}
  `;
  conversation.appendChild(staffBubble);

  // é¸æŠè‚¢ã®æç”»
  options.innerHTML = "";
  if (step.options.length > 0) {
    step.options.forEach(option => {
      const btn = document.createElement("button");
      btn.textContent = option.text;
      btn.onclick = () => showStep(option.next, option.text);
      options.appendChild(btn);
    });
  } else {
    endConversation();
  }

  conversation.scrollTop = conversation.scrollHeight;
}

const restartBtn = document.getElementById('restartBtn');

// ã™ã¹ã¦ã®ã‚¹ãƒ†ãƒƒãƒ—ãŒçµ‚ã‚ã£ãŸã‚‰ãƒœã‚¿ãƒ³ã‚’è¡¨ç¤º
function endConversation() {
  const staffBubble = document.createElement("div");
  staffBubble.className = "chat-bubble staff";
  staffBubble.innerHTML = `ğŸ‘¨â€ğŸ³ ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã—ãŸ`;
  conversation.appendChild(staffBubble);
  restartBtn.style.display = 'block';
  conversation.scrollTop = conversation.scrollHeight;
}

// ã€Œæœ€åˆã«æˆ»ã‚‹ã€ãƒœã‚¿ãƒ³ãŒæŠ¼ã•ã‚ŒãŸã¨ãã®å‡¦ç†
restartBtn.onclick = () => {
  conversation.innerHTML = '';
  options.innerHTML = '';
  restartBtn.style.display = 'none';
  currentStep = "start"; // â† æœ€åˆã®ã‚¹ãƒ†ãƒƒãƒ—ã«æˆ»ã™
  showStep(currentStep); // â† å†è¡¨ç¤º
};


showStep(currentStep);
</script>

</body>
</html>
